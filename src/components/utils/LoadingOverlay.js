import { Box, keyframes, Stack } from '@mui/material';
import React, { useEffect, useState } from 'react';

const slideUp = keyframes`
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-100%);
  }
`;

const draw = keyframes`
  0% {
    stroke-dasharray: 0, 200;
    stroke-dashoffset: 0;

  }
  100% {
    stroke-dasharray: 200, 0;
    stroke-dashoffset: 0;
  }
`;

const fill = keyframes`
  0% {
    fill: transparent;
  }
  100% {
    fill: white;
  }
`;

const disappear = keyframes`
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
`;

const LoadingOverlay = ({ isExiting, imagesLoaded, setIsAnimationEnded }) => {
  const [animationKey, setAnimationKey] = useState(0);

  useEffect(() => {
    if (isExiting) {
      const timer = setTimeout(() => {
        setIsAnimationEnded(true);
      }, 1000); // Durée de l'animation de sortie
      return () => clearTimeout(timer);
    }
  }, [isExiting, setIsAnimationEnded]);

  useEffect(() => {
    if(imagesLoaded) return;

    const timer = setTimeout(() => {
      setAnimationKey(prev => prev + 1); // Changer la clé pour redémarrer l'animation
    }, 5000); // Temps total des animations: 2s draw + 2s fill + 1s disappear
    return () => clearTimeout(timer);
  }, [imagesLoaded, animationKey]);

  return (
    <Box
    key={animationKey}
      sx={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        backgroundColor: '#241D19',
        color: '#fff',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        zIndex: 1000,
        animation: isExiting ? `${slideUp} 1s cubic-bezier(0.42, 0, 0.58, 1) forwards` : 'none',
        overflow: 'hidden'
      }}
    >
      <Stack width='80vw' justifyContent='center' alignItems='center' >
        <Box 
          component='svg' 
          width="75vw" 
          height='auto' 
          maxWidth='250px' 
          viewBox="0 0 361 227" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          sx={{
            '& path': {
              stroke: 'white',
              strokeWidth: 2.5,
              strokeDasharray: '200',
              strokeDashoffset: '200',
              animation: `${draw} 2s ease forwards, ${fill} 2s ease forwards 2s, ${disappear} 1s ease forwards 4s`,
            },
            '& .half-circle': {
              stroke: 'white',
              strokeWidth: 5,
              strokeDasharray: '200',
              strokeDashoffset: '200',
              animation: `${draw} 2s ease forwards, ${disappear} 1s ease forwards 4s`,
            },
          }}
        >
          <path d="M230.071 148.797C230.071 146.752 231.594 145.067 233.578 144.774V89.5L235.5 86.5L236.6 84L237.4 82L238 80L238.5 77L238.7 75L239 73H240.5L241.3 75L241.5 77L242 80L242.7 82.5L243.6 84.5L244.5 86.5L246 89L247.24 91L247.167 144.774C249.151 145.067 250.674 146.752 250.674 148.797V151.172C250.674 153.187 249.187 154.86 247.24 155.183L247.27 159.267C247.319 159.885 247.574 160.502 248.629 160.502H261.746C262.88 160.502 263.802 161.414 263.802 162.541V165.084H271.009V162.541C271.015 161.414 271.464 160.502 272.023 160.502H278.587C279.145 160.502 279.6 161.414 279.6 162.541V171.194H275.135V178.995H279.6V187.654C279.6 188.776 279.145 189.687 278.587 189.687H272.023C271.464 189.687 271.015 188.776 271.015 187.654V185.106H263.802V187.654C263.802 188.776 262.88 189.687 261.746 189.687H248.617C247.786 189.777 247.549 190.317 247.501 190.874L247.58 202.076C247.58 204.324 245.736 206.147 243.461 206.147H237.285C235.01 206.147 233.165 204.324 233.165 202.076L233.505 155.183C231.558 154.86 230.071 153.187 230.071 151.172V148.797Z" stroke="white" strokeWidth="2.5"/>
          <path d="M220 48.1V48.1C226.229 31.4559 249.771 31.4559 256 48.1V48.1" className='half-circle' stroke="white" strokeWidth="5"/>
          <path d="M46.4993 82.5492C49.1761 82.5492 51.7713 82.0901 54.2986 81.1872C56.8259 80.2537 58.6874 79.3814 59.8695 78.5397L61.6223 77.1777L69.109 94.0116C68.8645 94.2105 68.5248 94.5013 68.09 94.8533C67.6416 95.1899 66.6361 95.848 65.0464 96.8121C63.4702 97.7456 61.7718 98.572 59.9646 99.276C58.1575 99.9799 55.7796 100.607 52.8447 101.158C49.9234 101.709 46.9069 102 43.7818 102C36.6211 102 29.8274 100.026 23.4004 96.0622C16.9871 92.0986 11.8102 86.6506 7.88342 79.7181C3.9702 72.755 2 65.2409 2 57.176C2 51.0546 3.15494 45.2086 5.45124 39.5922C7.76113 33.9759 10.8319 29.1705 14.6636 25.1763C18.4953 21.1668 22.9792 17.9837 28.0882 15.5963C33.1971 13.1937 38.4283 12 43.7818 12C48.7684 12 53.361 12.6581 57.5596 14.0048C61.7853 15.3362 64.7474 16.6676 66.4866 18.0143L69.109 20.019L61.6223 36.8529C61.2011 36.4244 60.5489 35.9194 59.6657 35.3379C58.7961 34.741 57.0569 33.9453 54.4345 32.9658C51.8256 31.9711 49.1761 31.4814 46.4993 31.4814C42.26 31.4814 38.4555 32.2466 35.0858 33.7922C31.7296 35.3379 29.0665 37.3732 27.1098 39.9136C25.1396 42.4234 23.645 45.1474 22.6124 48.0551C21.5933 50.9628 21.077 53.9316 21.077 56.9464C21.077 63.5423 23.2646 69.4647 27.6533 74.6985C32.0421 79.9323 38.3332 82.5492 46.4993 82.5492ZM80.4547 94.0116C75.1283 88.6706 72.4652 81.8453 72.4652 73.5048C72.4652 65.1338 75.237 58.2778 80.7672 52.9063C86.3245 47.5348 93.1862 44.8414 101.352 44.8414C109.383 44.8414 116.149 47.5501 121.666 52.9675C127.182 58.3544 129.941 65.2103 129.941 73.5048C129.941 81.7687 127.25 88.5941 121.87 93.9504C116.475 99.3219 109.641 102 101.352 102C92.7514 102 85.7946 99.3372 80.4547 94.0116ZM93.2542 64.3227C91.1073 66.7101 90.0339 69.7555 90.0339 73.5048C90.0339 77.2083 91.0666 80.2537 93.1183 82.5951C95.1836 84.9366 97.9011 86.1149 101.257 86.1149C104.505 86.1149 107.168 84.9213 109.247 82.5492C111.326 80.1466 112.372 77.1165 112.372 73.4742C112.372 69.7555 111.298 66.7101 109.152 64.3227C107.005 61.9354 104.382 60.757 101.257 60.757C98.0778 60.757 95.4146 61.9354 93.2542 64.3227ZM163.312 60.1143C160.187 60.1143 157.51 61.4151 155.254 64.0167C153.012 66.603 151.898 69.7249 151.898 73.3671C151.898 77.0859 153.012 80.2537 155.254 82.8553C157.51 85.4569 160.187 86.7577 163.312 86.7577C164.793 86.7577 166.206 86.5434 167.551 86.1149C168.896 85.6864 169.875 85.2733 170.5 84.8601L171.342 84.2173L176.954 97.1641C176.505 97.5314 175.907 97.9752 175.133 98.5108C174.345 99.0158 172.565 99.7351 169.793 100.638C167.021 101.541 164.045 102 160.866 102C153.841 102 147.659 99.2148 142.319 93.6443C136.993 88.0585 134.329 81.3862 134.329 73.5967C134.329 65.7307 136.993 58.9818 142.319 53.3195C147.659 47.6725 153.841 44.8414 160.866 44.8414C164.045 44.8414 166.967 45.2699 169.657 46.1269C172.347 46.9685 174.25 47.8102 175.35 48.6519L176.954 49.9068L171.342 62.6547C169.29 60.956 166.614 60.1143 163.312 60.1143ZM188.286 94.0116C182.973 88.6706 180.31 81.8453 180.31 73.5048C180.31 65.1338 183.068 58.2778 188.612 52.9063C194.169 47.5348 201.031 44.8414 209.197 44.8414C217.227 44.8414 223.994 47.5501 229.497 52.9675C235.027 58.3544 238.7 65.2103 238.7 73.5048C238.7 81.7687 235.095 88.5941 229.701 93.9504C224.32 99.3219 217.485 102 209.197 102C200.596 102 193.626 99.3372 188.286 94.0116ZM201.099 64.3227C198.952 66.7101 197.879 69.7555 197.879 73.5048C197.879 77.2083 198.898 80.2537 200.949 82.5951C203.028 84.9366 205.746 86.1149 209.102 86.1149C212.336 86.1149 214.999 84.9213 217.091 82.5492C219.17 80.1466 220.217 77.1165 220.217 73.4742C220.217 69.7555 219.143 66.7101 216.996 64.3227C214.849 61.9354 212.227 60.757 209.102 60.757C205.922 60.757 203.259 61.9354 201.099 64.3227ZM250.15 94.0116C244.837 88.6706 241.3 81.8453 241.3 73.5048C241.3 65.1338 244.932 58.2778 250.476 52.9063C256.033 47.5348 262.881 44.8414 271.061 44.8414C279.091 44.8414 285.858 47.5501 291.361 52.9675C296.891 58.3544 299.649 65.2103 299.649 73.5048C299.649 81.7687 296.959 88.5941 291.565 93.9504C286.184 99.3219 279.35 102 271.061 102C262.46 102 255.49 99.3372 250.15 94.0116ZM262.949 64.3227C260.816 66.7101 259.743 69.7555 259.743 73.5048C259.743 77.2083 260.762 80.2537 262.814 82.5951C264.892 84.9366 267.61 86.1149 270.966 86.1149C274.2 86.1149 276.863 84.9213 278.956 82.5492C281.034 80.1466 282.081 77.1165 282.081 73.4742C282.081 69.7555 281.007 66.7101 278.86 64.3227C276.714 61.9354 274.078 60.757 270.966 60.757C267.787 60.757 265.11 61.9354 262.949 64.3227ZM307.503 100.439V46.4329H324.039V52.1105H324.229C328.537 47.2593 333.116 44.8414 337.966 44.8414C340.331 44.8414 342.681 45.1933 345.018 45.8973C347.355 46.6013 349.597 47.6878 351.744 49.1569C353.905 50.6261 355.657 52.7227 356.989 55.4314C358.334 58.1401 359 61.2773 359 64.8584V100.439H342.464V69.8932C342.464 67.0927 341.662 64.6441 340.059 62.5475C338.483 60.4356 336.417 59.395 333.849 59.395C331.363 59.395 329.107 60.4816 327.083 62.6547C325.058 64.8277 324.039 67.2457 324.039 69.8932V100.439H307.503Z" stroke="white" strokeWidth="2.67962"/>
        </Box>
      </Stack>
    </Box>
  );
};

export default LoadingOverlay;
